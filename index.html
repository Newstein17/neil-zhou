<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Neil Zhou — 影像 × 设计</title>
<meta name="description" content="Neil Zhou｜艺术设计 × 科技｜视频SE｜相机/ISP｜影像与计算摄影"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Orbitron:wght@600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0e14; --text:#f2f6fb; --muted:#9fb0c8;
  --panel:rgba(255,255,255,.06); --radius:20px; --maxw:1200px;
  --shadow:0 18px 40px rgba(0,0,0,.45);
  --gap:18px;

  /* 首页（赛博朋克多色） */
  --home-g1:#00e6ff; --home-g2:#ff3ab2; --home-g3:#ffd400; --home-g4:#54e048;

  /* 各栏目单角主题色 */
  --about-c:#7afcff;     /* 青 */
  --projects-c:#ff7ad9;  /* 品红 */
  --gallery-c:#7850b3;   /* 紫 */
  --experience-c:#66ffa8;/* 青绿 */
  --contact-c:#ffd36e;   /* 金黄 */

  /* 画廊金×紫 */
  --lux-g1:#f6d365; --lux-g2:#b97adb;
  --lux-p1:#c86060; --lux-p2:#7e57c2;
}

/* 基础排版 */
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  overflow-x:hidden;
  padding-bottom:72px; /* 预留空间给贴底footer */
}
a{color:#c9f1ff;text-decoration:none} a:hover{text-decoration:underline}
.wrap{max-width:var(--maxw);margin:auto;padding:0 22px}
h1{margin:16px 0 8px;font-size:clamp(30px,6vw,60px);line-height:1.1}
h2{font-size:clamp(22px,3.6vw,36px);margin:0 0 22px}
section{padding:68px 0}
.row{display:flex;gap:10px;flex-wrap:wrap}

/* 顶部导航 */
header{position:sticky;top:0;z-index:60;backdrop-filter:blur(10px);
  background:linear-gradient(to bottom,rgba(10,14,20,.85),rgba(10,14,20,.35));
  border-bottom:1px solid rgba(255,255,255,.1)}
.nav{display:flex;align-items:center;gap:20px;padding:14px 20px}
.brand{font-family:Orbitron,Inter;letter-spacing:.16em;font-weight:600;font-size:16px;color:#fff}
.nav a{color:#e9f1ff;opacity:.9;padding:8px 12px;border-radius:999px;cursor:pointer;user-select:none}
.nav a:hover{background:var(--panel);opacity:1}
.nav .spacer{flex:1}
.btn{background:linear-gradient(135deg,rgba(255,255,255,.12),rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.2);padding:10px 14px;border-radius:999px;box-shadow:var(--shadow)}
.nav .active{background:rgba(255,255,255,.12);opacity:1}

/* 背景：粒子 + 渐变层（按路由切换） */
#bg,#grad{position:fixed;inset:0;z-index:-2;width:100vw;height:100vh}
#bg{z-index:-2}
#grad{z-index:-1;pointer-events:none;transition:opacity .35s ease, filter .35s ease}

/* 视图容器：交叉淡入（不位移） */
main{position:relative;min-height:70vh}
.view{position:absolute;inset:0;opacity:0;pointer-events:none;filter:blur(6px);transform:scale(.99)}
.view.active{position:relative;opacity:1;pointer-events:auto;filter:none;transform:none;transition:opacity .32s ease, filter .32s ease, transform .32s ease}

/* 通用UI */
.card{background:var(--panel);border:1px solid rgba(255,255,255,.16);border-radius:18px;padding:18px;box-shadow:var(--shadow);overflow:hidden}
.grid{display:grid;gap:18px}
.grid.cols-2{grid-template-columns:repeat(2,1fr)}
@media (max-width:900px){.grid.cols-2{grid-template-columns:1fr}}
.badge{display:inline-flex;gap:8px;padding:6px 12px;border-radius:999px;background:linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.04));border:1px solid rgba(255,255,255,.2);color:var(--muted);font-size:12px}
.subtitle{font-size:clamp(14px,2.4vw,18px);color:var(--muted)}

/* HERO */
.hero{display:grid;grid-template-columns:1.2fr .8fr;gap:40px;align-items:center;padding:8vh 0 10vh}
@media (max-width: 900px){ .hero{grid-template-columns:1fr;padding:6vh 0} }
.panel{background:linear-gradient(to bottom right, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.16); border-radius: var(--radius); padding:20px; box-shadow: var(--shadow)}
.kv{aspect-ratio:4/3;border-radius:var(--radius);overflow:hidden;position:relative}
.kv video,.kv img{width:100%;height:100%;object-fit:cover;display:block;filter:contrast(1.06) saturate(1.08)}
.scanline{position:absolute;inset:0;background:repeating-linear-gradient(to bottom,rgba(255,255,255,.05) 0 1px, transparent 1px 3px);mix-blend-mode:overlay;opacity:.18;animation:scan 6s linear infinite}
@keyframes scan{to{transform:translateY(3px)}}

/* 画廊（金×紫） */
body.mode-gallery{background:#0e1016}
.gallery-wrap{max-width:min(1500px,94vw);margin:0 auto}
.g-topbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin-bottom:14px}
.g-tabs{display:flex;gap:8px;flex-wrap:wrap}
.g-tabs button{cursor:pointer;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);color:#fff;border-radius:999px;padding:8px 14px}
.g-tabs button.active{background:linear-gradient(120deg,rgba(246,211,101,.35),rgba(176,133,245,.28));border-color:rgba(255,255,255,.35)}
.g-pages{display:flex;gap:8px;align-items:center}
.g-pages button{cursor:pointer;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);color:#fff;border-radius:10px;padding:6px 10px}
.g-pages button.active{background:linear-gradient(120deg,rgba(246,211,101,.35),rgba(176,133,245,.28))}
.gallery{display:grid;gap:var(--gap);grid-template-columns:repeat(12,1fr);grid-auto-rows:30px}
@media (max-width:1100px){.gallery{grid-template-columns:repeat(8,1fr)}}
@media (max-width:700px){.gallery{grid-template-columns:repeat(4,1fr);grid-auto-rows:26px}}
.tile{
  position:relative;overflow:hidden;border-radius:22px;background:#0c0f14;border:2px solid transparent;
  background-image:linear-gradient(#0c0f14,#0c0f14),linear-gradient(140deg,var(--lux-g1),var(--lux-g2));
  background-origin:border-box;background-clip:padding-box,border-box;
  box-shadow:0 22px 60px rgba(0,0,0,.55),0 0 0 1px rgba(255,255,255,.05) inset;
  transition:transform .28s ease, box-shadow .28s ease, filter .28s ease}
.tile::after{content:"";position:absolute;inset:3px;border-radius:18px;pointer-events:none;background:linear-gradient(160deg,rgba(176,133,245,.12),rgba(126,87,194,.08));mix-blend-mode:screen}
.tile:hover{transform:translateY(-2px);box-shadow:0 30px 80px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,.1) inset;filter:saturate(1.05)}
.tile img,.tile video{width:100%;height:100%;object-fit:cover;display:block}
.tile .cap{position:absolute;left:0;right:0;bottom:0;padding:14px 16px;font-size:13px;color:#0b0e14;background:linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.95) 100%);font-weight:700;letter-spacing:.02em;mix-blend-mode:screen;opacity:.0;transition:.22s}
.tile:hover .cap{opacity:.95}

/* 灯箱（含B站内嵌） */
.lightbox{position:fixed;inset:0;background:rgba(6,6,10,.88);display:none;align-items:center;justify-content:center;z-index:100}
.lightbox.open{display:flex}
.lightbox-content{max-width:92vw;max-height:86vh;border-radius:16px;overflow:hidden;box-shadow:0 25px 80px rgba(0,0,0,.7);background:radial-gradient(420px 300px at 70% 20%, rgba(176,133,245,.14), transparent 60%)}
.lightbox-content img,.lightbox-content video{width:100%;height:100%;object-fit:contain;background:#000}
.lightbox iframe{width:86vw;height:60vh;border:0}
.lightbox-close{position:fixed;top:20px;right:24px;background:#fff;color:#111;border:none;border-radius:999px;padding:10px 14px;font-weight:700;cursor:pointer}

/* 时间线 */
.timeline{position:relative;padding-left:26px}
.timeline:before{content:"";position:absolute;left:8px;top:6px;bottom:6px;width:2px;background:linear-gradient(#cde8ff,#ffd1f2)}
.titem{position:relative;margin:14px 0;padding:12px 14px;background:var(--panel);border:1px solid rgba(255,255,255,.14);border-radius:12px}
.titem:before{content:"";position:absolute;left:-22px;top:14px;width:10px;height:10px;border-radius:50%;background:#cde8ff}

/* 贴底页脚 */
footer{
  position:fixed; left:0; right:0; bottom:0; z-index:70;
  backdrop-filter: blur(10px);
  background: linear-gradient(to top, rgba(10,14,20,.85), rgba(10,14,20,.35));
  border-top:1px solid rgba(255,255,255,.12);
  padding:14px 0;
  color:var(--muted);
}

/* 降动效 */
@media (prefers-reduced-motion:reduce){#grad,.scanline,.view{animation:none;transition:none}}
</style>
</head>
<body>
  <!-- 背景 -->
  <canvas id="bg" aria-hidden="true"></canvas>
  <div id="grad" aria-hidden="true"></div>

  <header>
    <nav class="nav">
      <div class="brand">NEIL ZHOU</div>
      <a data-route="home" class="active">首页</a>
      <a data-route="about">关于我</a>
      <a data-route="projects">项目</a>
      <a data-route="gallery">画廊</a>
      <a data-route="experience">经历</a>
      <a data-route="contact">联系</a>
      <div class="spacer"></div>
      <a class="btn" href="#cv">下载简历</a>
    </nav>
  </header>

  <main class="wrap">
    <!-- 首页 -->
    <div id="view-home" class="view active">
      <section class="hero">
        <div>
          <div class="badge">艺术设计 × 科技｜视频SE｜相机 / ISP</div>
          <h1>你好，我是 Neil。<br/>做影片艺术，也做影像系统设计。</h1>
          <p class="subtitle">把 <strong>视频画质 / ISP Pipeline / 编解码</strong> 和 <strong>电影技术</strong> 混合出新的灵感。</p>
          <div class="row" style="margin-top:14px">
            <a class="btn" data-route="projects">查看项目(in progress)</a>
            <a class="btn" data-route="gallery">进入画廊</a>
          </div>
        </div>
        <div class="panel">
          <div class="kv">
            <img src="assets/gallery/myself01.jpg" poster="assets/gallery/myself01.jpg" autoplay muted loop playsinline></img>
            <div class="scanline"></div>
          </div>
          <div class="subtitle" style="margin-top:10px">关于我｜this is me</div>
        </div>
      </section>
    </div>

    <!-- 关于我 -->
    <div id="view-about" class="view">
      <section id="about">
        <h2>关于我</h2>
        <div class="grid cols-2">
          <div class="card">
            <h3>Bio</h3>
            <p>视频系统工程师（SE），聚焦 <strong>ISP 架构、视频调优、AI 视频处理、系统功耗</strong>。项目涉及 Lofic/DCG/HDR、Dolby Vision 录制、EIS/DIS 稳像、AINR 联合降噪等。私下做摄影与图形设计，偏爱波普与电影感的融合。</p>
            <p class="subtitle">关键词：IFE/BPS/IPE｜AINR｜Dolby Vision｜色域映射｜多光谱｜UX 叙事</p>
          </div>
          <div class="card">
            <h3>现在在做</h3>
            <ul>
              <li>高帧率视频链路画质/功耗平衡</li>
              <li>视频 AINR（去噪+去马赛克）工程化</li>
              <li>调色与色调/色域映射可视化工具</li>
              <li>个人影像：街头、空间与光</li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <!-- 项目 -->
    <div id="view-projects" class="view">
      <section id="projects">
        <h2>精选项目</h2>
        <div class="grid cols-2">
          <article class="card">
            <h3>Dolby Vision 录制链路优化</h3>
            <p class="subtitle">视频系统｜功耗｜HDR｜2025</p>
            <p>整合 RPU 元数据生成与编码打包；对夜景 HDR 做亮度结构优化，降低能耗与发热。</p>
          </article>
          <article class="card">
            <h3>视频 AINR & 稳像协同</h3>
            <p class="subtitle">AI｜去噪｜EIS/DIS｜2025</p>
            <p>把时域降噪与稳像轨迹约束协同设计，构建统一时域特征缓存，减少重复计算。</p>
          </article>
        </div>
      </section>
    </div>

    <!-- 画廊：分组分页 + 自动布局 + B站内嵌 -->
    <div id="view-gallery" class="view">
      <section id="gallery" class="gallery-wrap">
        <h2>画廊（摄影 + 视频）</h2>
        <div class="g-topbar">
          <div class="g-tabs">
            <button class="active" data-group="film">film</button>
            <button data-group="nature">nature</button>
            <button data-group="city">city</button>
            <button data-group="food">food</button>
          </div>
          <div class="g-pages" id="gPages"></div>
        </div>
        <div class="gallery" id="galleryGrid"></div>
      </section>
    </div>

    <!-- 经历 -->
    <div id="view-experience" class="view">
      <section id="experience">
        <h2>经历</h2>
        <div class="timeline">
          <div class="titem">
            <strong>视频系统工程师（SE）</strong>｜相机影像<br/>
            <span class="subtitle">2023 — 至今｜北京 / 上海</span>
            <ul>
              <li>视频能力规划与端到端方案设计（ISP/算法/编码）。</li>
              <li>HDR、稳像、AI降噪、多摄协同、色域映射等方向。</li>
              <li>跨团队评审与风险推进，沉淀工具链与 SOP。</li>
            </ul>
          </div>
          <div class="titem">
            <strong>算法与软件工程</strong>｜多光谱 / AR<br/>
            <span class="subtitle">2021 — 2023</span>
            <ul><li>AR 眼镜畸变校正与数据链路；多光谱移动端推理。</li></ul>
          </div>
        </div>
      </section>
    </div>

    <!-- 联系 -->
    <div id="view-contact" class="view">
      <section id="contact">
        <h2>联系</h2>
        <div class="grid cols-2">
          <div class="card">
            <p>合作/交流请发邮件，或在 B 站与我互动。也欢迎添加微信进一步沟通（备注来意）。</p>
            <div class="row">
              <a class="btn" href="mailto:youremail@example.com">Email</a>
              <a class="btn" href="https://space.bilibili.com/" target="_blank" rel="noreferrer">Bilibili</a>
              <a class="btn" href="#">WeChat</a>
            </div>
          </div>
          <div class="card">
            <h3>资源与下载</h3>
            <ul>
              <li><a href="#cv" download>个人简历（PDF）</a></li>
              <li><a href="#">项目白皮书（Notion/Markdown）</a></li>
              <li><a href="#">摄影集选（JPEG.zip）</a></li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- 贴底页脚 -->
  <footer>
    <div class="wrap" style="display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <div>© <span id="year"></span> Neil Zhou — Pop Cinema</div>
      <div class="subtitle">Welcome here</div>
    </div>
  </footer>

  <!-- 灯箱 -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <button class="lightbox-close" id="lightboxClose">关闭</button>
    <div class="lightbox-content" id="lightboxContent"></div>
  </div>

<script>
/* 年份 */
document.getElementById('year').textContent = new Date().getFullYear();

/* 背景渐变：根据路由设置“角落 + 颜色” */
const grad = document.getElementById('grad');
function setGradient(route){
  if(route==='home'){
    grad.style.background = `
      radial-gradient(900px 650px at 10% 18%, rgba(0,230,255,.22), transparent 60%),
      radial-gradient(740px 520px at 88% 18%, rgba(255,58,178,.18), transparent 62%),
      radial-gradient(980px 720px at 12% 84%, rgba(255,212,0,.16), transparent 60%),
      radial-gradient(900px 700px at 88% 86%, rgba(122,252,255,.14), transparent 60%)`;
    grad.style.opacity = 1; document.body.classList.remove('mode-gallery');
    return;
  }
  const map = {
    about:   {c:'var(--about-c)',    pos:'10% 14%'},
    projects:{c:'var(--projects-c)', pos:'88% 14%'},
    gallery: {c:'var(--gallery-c)',  pos:'88% 86%'},
    experience:{c:'var(--experience-c)', pos:'12% 86%'},
    contact: {c:'var(--contact-c)',  pos:'88% 14%'}
  };
  const conf = map[route]||map.about;
  grad.style.background = `radial-gradient(900px 650px at ${conf.pos}, color-mix(in oklab, ${conf.c} 30%, transparent), transparent 60%)`;
  grad.style.opacity = 1;
  if(route==='gallery') document.body.classList.add('mode-gallery'); else document.body.classList.remove('mode-gallery');
}

/* ===== 粒子引擎：每个页面独立“风格” ===== */
const canvas = document.getElementById('bg'); 
const ctx = canvas.getContext('2d');
let w,h,dpr,particles=[]; 
let mouseX=.5, mouseY=.5; 
let t=0;

const MODES = {
  neonFlow: { // 首页
    density: 9000, speed: .12,
    color: () => `hsla(${(t*360)%360}, 85%, 80%, .85)`,
    connect: { dist: 130, alpha: 0.06, color: 'hsla(50, 90%, 70%, VAR)' },
    step(p){ const fx = Math.sin((p.y*0.002)+t*2)*0.09, fy = Math.cos((p.x*0.002)+t*2)*0.09;
      p.vx = (p.vx+fx + (mouseX-.5)*0.003)*0.986; p.vy = (p.vy+fy + (mouseY-.5)*0.003)*0.986; },
    radius:[.5, 2.1]
  },
  drift: { // 关于
    density: 9500, speed: .05,
    color: () => 'rgba(250,255,255,0.85)', connect: null,
    step(p){ p.vx += (Math.random()-.5)*1.1; p.vy += (Math.random()-.5)*0.3; p.vx*=0.95; p.vy*=0.95; },
    //step(p){ p.vx += Math.sin((p.y*0.003)+t*3)*0.03; p.vy += Math.cos(t*2)*0.005; p.vx*=0.985; p.vy*=0.985; },
    radius:[.4, 2.4]
  },
  orbitRings: { // 项目
    density: 20000, speed: .005,
    color: () => 'rgba(210,235,255,0.9)',
    connect: { dist: 150, alpha: 0.4, color: 'rgba(200,230,255,VAR)' },
    step(p){ const cx=w*0.5, cy=h*0.5; p._theta=(p._theta||Math.random()*Math.PI*2)+0.002; p._rad=p._rad||(Math.random()*Math.min(w,h)*0.45+30);
      p.x=cx+Math.cos(p._theta)*p._rad*2.5; p.y=cy+Math.sin(p._theta)*p._rad; if(Math.random()<0.003) p._tw=1; },
    radius:[.6, 2.2]
  },
  waveSheen: { // 画廊
    density: 11200, speed: .08,
    color: () => 'rgba(255,255,255,0.82)',
    connect: { dist: 140, alpha: 0.035, color: 'rgba(200,160,255,VAR)' },
    step(p){ p.vx += Math.sin((p.y*0.003)+t*3)*0.03; p.vy += Math.cos(t*2)*0.005; p.vx*=0.985; p.vy*=0.985; },
    radius:[.6, 1.9]
  },
  constellation: { // 经历
    density: 12000, speed: .1,
    color: () => 'rgba(245,250,255,0.9)',
    connect: { dist: 190, alpha: 0.08, color: 'rgba(180,220,255,VAR)' },
    step(p){ const fx=Math.sin((p.y*0.0015)+t*1.4)*0.07, fy=Math.cos((p.x*0.0015)+t*1.6)*0.07; p.vx=(p.vx+fx)*0.987; p.vy=(p.vy+fy)*0.987; },
    radius:[.7, 2.0]
  },
  sprint: { // 联系
    density: 10000, speed: .16,
    color: () => 'rgba(255,255,255,0.85)', connect: null,
    step(p){ p.vx += 0.015; p.vy += 0.008; p.vx*=0.99; p.vy*=0.99; },
    radius:[.6, 1.6]
  }
};

let currentMode = MODES.neonFlow;

function resize(){
  dpr = Math.max(1, Math.min(2, window.devicePixelRatio||1));
  w = canvas.width = Math.floor(innerWidth*dpr);
  h = canvas.height = Math.floor(innerHeight*dpr);
  canvas.style.width = innerWidth+'px'; 
  canvas.style.height = innerHeight+'px';
  initParticles();
}
function rnd(min,max){ return Math.random()*(max-min)+min; }

function initParticles(){
  const count = Math.floor((innerWidth*innerHeight)/currentMode.density);
  particles = new Array(count).fill(0).map(()=>({
    x: Math.random()*w, y: Math.random()*h,
    vx: (Math.random()-.5)*currentMode.speed, 
    vy: (Math.random()-.5)*currentMode.speed,
    r: rnd(currentMode.radius[0], currentMode.radius[1])
  }));
}

function loop(){
  t += 0.0024; 
  ctx.clearRect(0,0,w,h);

  // 背景柔光（极淡）
  const g = ctx.createRadialGradient(w*mouseX, h*mouseY, 0, w*.5, h*.5, Math.max(w,h)*.8);
  g.addColorStop(0, 'rgba(255,255,255,0.03)'); 
  g.addColorStop(1, 'rgba(255,255,255,0.00)');
  ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

  const col = currentMode.color;

  for(const p of particles){
    currentMode.step(p);
    p.x += p.vx; p.y += p.vy;
    if(p.x<0)p.x+=w; if(p.x>w)p.x-=w; if(p.y<0)p.y+=h; if(p.y>h)p.y-=h;

    let fill = col();
    if(currentMode===MODES.orbitRings && p._tw){ fill = 'rgba(255,255,255,0.95)'; p._tw = 0; }
    ctx.beginPath(); ctx.arc(p.x, p.y, p.r*dpr, 0, Math.PI*2);
    ctx.fillStyle = fill; ctx.fill();
  }

  if(currentMode.connect){
    const maxd = (currentMode.connect.dist*dpr)*(currentMode.connect.dist*dpr);
    for(let i=0;i<particles.length;i++){
      const a=particles[i];
      for(let j=i+1;j<i+10 && j<particles.length;j++){
        const b=particles[j], dx=a.x-b.x, dy=a.y-b.y, d=dx*dx+dy*dy;
        if(d < maxd){
          const alpha = currentMode.connect.alpha * (1 - d/maxd);
          ctx.strokeStyle = currentMode.connect.color.replace('VAR', alpha.toFixed(3));
          ctx.lineWidth = .6*dpr; 
          ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
        }
      }
    }
  }

  requestAnimationFrame(loop);
}
window.addEventListener('resize', resize, {passive:true});
window.addEventListener('pointermove', e=>{
  const r = canvas.getBoundingClientRect(); 
  mouseX = (e.clientX - r.left)/r.width; 
  mouseY = (e.clientY - r.top)/r.height; 
},{passive:true});
resize(); loop();

/* 视图路由：交叉淡入 + 背景/粒子同步 */
const routes = ["home","about","projects","gallery","experience","contact"];
const view = r => document.getElementById(`view-${r}`);
const navBtns = Array.from(document.querySelectorAll('.nav a[data-route], .btn[data-route]'));
let current = "home";

function setActiveNav(r){ document.querySelectorAll('.nav a[data-route]').forEach(a=>a.classList.toggle('active', a.dataset.route===r)); }

function switchTo(r){
  if(r===current || !routes.includes(r)) return;
  const from = view(current), to = view(r);

  // 背景渐变 & 粒子模式
  setGradient(r);
  if(r==='home'){ currentMode = MODES.neonFlow; }
  else if(r==='about'){ currentMode = MODES.drift; }
  else if(r==='projects'){ currentMode = MODES.orbitRings; }
  else if(r==='gallery'){ currentMode = MODES.waveSheen; }
  else if(r==='experience'){ currentMode = MODES.constellation; }
  else if(r==='contact'){ currentMode = MODES.sprint; }
  initParticles();

  // 交叉淡入淡出
  to.classList.add('active');
  from.style.transition = 'opacity .26s ease, filter .26s ease';
  to.style.transition   = 'opacity .32s ease, filter .32s ease, transform .32s ease';
  from.style.opacity = 0; from.style.filter = 'blur(6px)';
  to.style.opacity = 1;   to.style.filter = 'none'; to.style.transform='none';

  setTimeout(()=>{ from.classList.remove('active'); from.removeAttribute('style'); to.removeAttribute('style'); }, 340);

  current = r; setActiveNav(r); history.replaceState(null,"",`#${r}`);
}
navBtns.forEach(b=>b.addEventListener('click', e=>{ const r=e.currentTarget.dataset.route; if(r){e.preventDefault(); switchTo(r);} }));
window.addEventListener('load', ()=>{ const h=(location.hash||'#home').slice(1); setGradient('home'); if(routes.includes(h)){ current="home"; switchTo(h);} });

/* ===== 画廊数据（分组+分页） 按需替换你的路径/BV号 ===== */
const galleryData = {
  film: [
    [
      {type:'bili', bvid:'BV1QRyaYhEEQ', title:'B站短片：newstein film10', cover:'assets/gallery/newsVideo/250824_2.jpg', colspan:12},
      {type:'bili', bvid:'BV1N3411k7Dy', title:'B站短片：newstein film9', cover:'assets/gallery/newsVideo/250824_8.jpg', colspan:12},
      {type:'bili', bvid:'BV1Yg411M7is', title:'B站短片：newstein film8', cover:'assets/gallery/newsVideo/250824_7.jpg', colspan:12},
      {type:'bili', bvid:'BV1eK4y1p7fh', title:'B站短片：newstein film7', cover:'assets/gallery/newsVideo/250824_6.jpg', colspan:12},
      {type:'bili', bvid:'BV1Pr4y1F7Gw', title:'B站短片：newstein film6', cover:'assets/gallery/newsVideo/250824_5.jpg', colspan:12},
      {type:'bili', bvid:'BV1r64y1F76u', title:'B站短片：newstein film5', cover:'assets/gallery/newsVideo/250824_4.jpg', colspan:12},
      {type:'bili', bvid:'BV1mV411r7pp', title:'B站短片：newstein film4', cover:'assets/gallery/newsVideo/250824_3.jpg', colspan:12},
      {type:'bili', bvid:'BV1H4411u7q7', title:'B站短片：newstein film1', cover:'assets/gallery/newsVideo/250824_1.jpg', colspan:12}
    ]
  ],
  nature: [[
          {type:'img', src:'assets/gallery/nature/250824_51.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_57.jpg', title:'nature', colspan:5},
      {type:'img', src:'assets/gallery/nature/250824_59.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_54.jpg', title:'nature', colspan:5},
      {type:'img', src:'assets/gallery/nature/250824_6.jpg', title:'nature', colspan:7},
      {type:'img', src:'assets/gallery/nature/250824_1.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_15.jpg', title:'nature', colspan:4},
      {type:'img', src:'assets/gallery/nature/250824_18.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_19.jpg', title:'nature', colspan:7},
      {type:'img', src:'assets/gallery/nature/250824_2.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_20.jpg', title:'nature', colspan:4},
      {type:'img', src:'assets/gallery/nature/250824_3.jpg', title:'nature', colspan:5},
      {type:'img', src:'assets/gallery/nature/250824_42.jpg', title:'nature', colspan:5},
      {type:'img', src:'assets/gallery/nature/250824_43.jpg', title:'nature', colspan:4},
      {type:'img', src:'assets/gallery/nature/250824_44.jpg', title:'nature', colspan:4},
      {type:'img', src:'assets/gallery/nature/250824_45.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_46.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_47.jpg', title:'nature', colspan:5},
      {type:'img', src:'assets/gallery/nature/250824_16.jpg', title:'nature', colspan:5},
      {type:'img', src:'assets/gallery/nature/250824_17.jpg', title:'nature', colspan:5}
      ],
      [
      {type:'img', src:'assets/gallery/nature/250824_48.jpg', title:'nature', colspan:5},
      {type:'img', src:'assets/gallery/nature/250824_49.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_5.jpg', title:'nature', colspan:4},
      {type:'img', src:'assets/gallery/nature/250824_50.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_52.jpg', title:'nature', colspan:5},
      {type:'img', src:'assets/gallery/nature/250824_55.jpg', title:'nature', colspan:6},
      {type:'img', src:'assets/gallery/nature/250824_56.jpg', title:'nature', colspan:4}
  ]],
  city: [[
      {type:'img', src:'assets/gallery/city/250824_7.jpg', title:'city', colspan:8},
      {type:'img', src:'assets/gallery/city/250824_8.jpg', title:'city', colspan:7},
      {type:'img', src:'assets/gallery/city/250824_10.jpg', title:'Color Blocks', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_11.jpg', title:'Saturation', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_12.jpg', title:'Complimentary', colspan:5},
      {type:'img', src:'assets/gallery/city/250824_13.jpg', title:'Palette Motion', colspan:6},
      {type:'img', src:'assets/gallery/city/250824_14.jpg', title:'city', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_21.jpg', title:'city', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_22.jpg', title:'city', colspan:5},
      {type:'img', src:'assets/gallery/city/250824_25.jpg', title:'city', colspan:6},
      {type:'img', src:'assets/gallery/city/250824_26.jpg', title:'city', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_27.jpg', title:'city', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_28.jpg', title:'city', colspan:3},
      {type:'img', src:'assets/gallery/city/250824_29.jpg', title:'city', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_30.jpg', title:'city', colspan:5},
      {type:'img', src:'assets/gallery/city/250824_31.jpg', title:'city', colspan:6},
      {type:'img', src:'assets/gallery/city/250824_32.jpg', title:'city', colspan:6},
      {type:'img', src:'assets/gallery/city/250824_33.jpg', title:'city', colspan:5},
      {type:'img', src:'assets/gallery/city/250824_34.jpg', title:'city', colspan:5},
      {type:'img', src:'assets/gallery/city/250824_35.jpg', title:'city', colspan:6},
      {type:'img', src:'assets/gallery/city/250824_36.jpg', title:'city', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_37.jpg', title:'city', colspan:3},
      {type:'img', src:'assets/gallery/city/250824_38.jpg', title:'city', colspan:7},
      {type:'img', src:'assets/gallery/city/250824_39.jpg', title:'city', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_4.jpg', title:'city', colspan:6},
      {type:'img', src:'assets/gallery/city/250824_40.jpg', title:'city', colspan:5},
      {type:'img', src:'assets/gallery/city/250824_41.jpg', title:'city', colspan:4},
      {type:'img', src:'assets/gallery/city/250824_58.jpg', title:'city', colspan:3}
      ],
      [ 
      {type:'img', src:'assets/gallery/city/250824_61.jpg', title:'city', colspan:12},
      {type:'img', src:'assets/gallery/city/250824_62.jpg', title:'city', colspan:5},
      {type:'img', src:'assets/gallery/city/250824_9.jpg', title:'city', colspan:4}
  ]],
  food: [[
      {type:'img', src:'assets/gallery/food/250824_53.jpg', title:'Space & Light', colspan:12},
      {type:'img', src:'assets/gallery/food/250824_23.jpg', title:'City Motion', colspan:8},
      {type:'img', src:'assets/gallery/food/250824_24.jpg', title:'Signature Wide', colspan:6}

  ]]
};

const grid = document.getElementById('galleryGrid');
const pagesBar = document.getElementById('gPages');
let curGroup = 'film', curPage = 0;

function createTile(item){
  const tile = document.createElement('div');
  tile.className = 'tile';
  const span = Math.min(12, Math.max(3, item.colspan||4));
  tile.style.gridColumn = `span ${span}`;
  tile.dataset.colspan = span;
  tile.dataset.type = item.type;
  if(item.src)   tile.dataset.src  = item.src;
  if(item.bvid)  tile.dataset.bvid = item.bvid;

  let media;

  if(item.type==='img'){
    media = new Image();
    media.src = item.src;
    media.alt = item.title || '';
    tile.appendChild(media);

  }else if(item.type==='video'){
    media = document.createElement('video');
    media.src = item.src;
    media.muted = true; media.loop = true; media.playsInline = true; media.autoplay = true;
    tile.appendChild(media);

  }else if(item.type==='bili'){
    if(item.cover){                  // ✅ 支持本地封面图
      media = new Image();
      media.src = item.cover;
      media.alt = item.title || '';
      tile.appendChild(media);
    }else{
      // 没传封面时才用占位块
      media = document.createElement('div');
      media.style.cssText = 'width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:800;letter-spacing:.06em;background:linear-gradient(120deg,rgba(246,211,101,.4),rgba(176,133,245,.35))';
      media.textContent = 'BILIBILI ▶';
      tile.appendChild(media);
    }
  }

  const cap = document.createElement('div');
  cap.className = 'cap';
  cap.textContent = item.title || '';
  tile.appendChild(cap);

  // 点击打开灯箱（img/video/B站）
  tile.addEventListener('click', ()=>{
    if(item.type==='bili')      openLightboxBili(item.bvid);
    else if(item.type==='video') openLightboxVideo(item.src);
    else                         openLightboxImage(item.src);
  });

  // 自动瀑布布局：根据媒体尺寸计算行跨度
  autoSpan(tile, media);
  if(item.type==='img' || (item.type==='bili' && item.cover)){
    media.addEventListener('load', ()=>autoSpan(tile, media)); // ✅ bili 封面加载后重算
  }
  if(item.type==='video'){
    media.addEventListener('loadedmetadata', ()=>autoSpan(tile, media));
  }

  return tile;
}

function autoSpan(tile, media){
  const cols = getComputedStyle(grid).gridTemplateColumns.split(' ').length;
  const gap = parseFloat(getComputedStyle(grid).gap)||18;
  const autoRow = parseFloat(getComputedStyle(grid).gridAutoRows)||30;
  const gridWidth = grid.clientWidth;
  const colWidth = (gridWidth - gap*(cols-1)) / cols;
  const cspan = parseInt(tile.dataset.colspan||4,10);
  const w0 = (media.videoWidth||media.naturalWidth||tile.clientWidth||1);
  const h0 = (media.videoHeight||media.naturalHeight||tile.clientHeight||1);
  const targetW = colWidth*cspan + gap*(cspan-1);
  const targetH = targetW * (h0/w0);
  const rowSpan = Math.ceil( (targetH + gap) / (autoRow + gap) );
  tile.style.gridRowEnd = `span ${Math.max(3,rowSpan)}`;
}

function renderPagesBar(n){
  pagesBar.innerHTML=''; if(n<=1) return;
  const prev=document.createElement('button'); prev.textContent='上一页';
  const next=document.createElement('button'); next.textContent='下一页';
  prev.addEventListener('click', ()=>{ if(curPage>0){ curPage--; renderGallery(); } });
  next.addEventListener('click', ()=>{ if(curPage<n-1){ curPage++; renderGallery(); } });
  pagesBar.appendChild(prev);
  for(let i=0;i<n;i++){ const dot=document.createElement('button'); dot.textContent=i+1; if(i===curPage) dot.classList.add('active'); dot.addEventListener('click', ()=>{curPage=i; renderGallery();}); pagesBar.appendChild(dot); }
  pagesBar.appendChild(next);
}
function renderGallery(){
  grid.innerHTML='';
  const pages = galleryData[curGroup]; curPage = Math.max(0, Math.min(curPage, pages.length-1));
  pages[curPage].forEach(item=> grid.appendChild(createTile(item)));
  renderPagesBar(pages.length);
  grid.animate([{opacity:.0, filter:'blur(6px)'},{opacity:1, filter:'blur(0)'}],{duration:280, easing:'ease-out'});
}
document.querySelectorAll('.g-tabs button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.g-tabs button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active'); curGroup = btn.dataset.group; curPage = 0; renderGallery();
  });
});

/* 灯箱 */
const lb = document.getElementById('lightbox'); const lbC = document.getElementById('lightboxContent'); const lbClose = document.getElementById('lightboxClose');
function openLightboxImage(src){ lbC.innerHTML=''; const img=new Image(); img.src=src; lbC.appendChild(img); openLB(); }
function openLightboxVideo(src){ lbC.innerHTML=''; const v=document.createElement('video'); v.src=src; v.controls=true; v.autoplay=true; v.playsInline=true; lbC.appendChild(v); openLB(); }
function openLightboxBili(bvid){ lbC.innerHTML=''; const f=document.createElement('iframe'); f.src=`https://player.bilibili.com/player.html?bvid=${encodeURIComponent(bvid)}&autoplay=1&high_quality=1&danmaku=0`; f.allow='autoplay; fullscreen'; f.allowFullscreen=true; lbC.appendChild(f); openLB(); }
function openLB(){ lb.classList.add('open'); lb.setAttribute('aria-hidden','false'); lb.animate([{opacity:0},{opacity:1}],{duration:160}); }
lbClose.addEventListener('click', closeLB); lb.addEventListener('click', e=>{ if(e.target===lb) closeLB(); });
function closeLB(){ lb.animate([{opacity:1},{opacity:0}],{duration:140}).onfinish=()=>{ lb.classList.remove('open'); lb.setAttribute('aria-hidden','true'); lbC.innerHTML=''; }; }

/* 初始化：默认渐变与画廊内容 */
setGradient('home'); renderGallery();
</script>
</body>
</html>
